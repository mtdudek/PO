import java.io.*;
import javax.swing.*;
import javax.swing.filechooser.FileNameExtensionFilter;

public class Program {
	
	static String getFileExtension(File file) {
	    String name = file.getName();
	    try {
	        return name.substring(name.lastIndexOf(".") + 1);
	    } catch (Exception e) {
	        return "";
	    }
	}
	
    public static void main(String[] args) throws IOException, ClassNotFoundException {
    	String path="";
    	JFrame frame=new JFrame("Wybór pliku");
    	frame.setVisible(false);
    	frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
    	JFileChooser chooser = new JFileChooser();
        FileNameExtensionFilter filter1 = new FileNameExtensionFilter(
            "Samocjody", "car"),
        						filter2 = new FileNameExtensionFilter(
        	"Tramwaj", "tram");
        chooser.addChoosableFileFilter(filter1);
        chooser.addChoosableFileFilter(filter2);
        if (args.length == 0) {
            int returnVal = chooser.showOpenDialog(frame);
            if(returnVal == JFileChooser.APPROVE_OPTION) {
            	path=chooser.getSelectedFile().getAbsolutePath();
            }
        }
        else 
        	path=args[0];
        File file = new File(path);
        String ex=getFileExtension(file);
        if (file.isFile()) {
        	if(ex.compareTo("car")==0||ex.compareTo("tram")==0)
        		deserializacja(path);
        	else {
        		System.out.println("ZŁA ŚCIERZKA!!!");
        	}
        }
        else if(args[1].compareTo("Samochod")==0&&ex.compareTo("tram")!=0) {
        	Samochod car = new Samochod();
            EdycjaSamochodu edycja = new EdycjaSamochodu(car);
            if (ex.compareTo("car")!=0)
            	path+=".car";
            edycja.edycja(path);
        }
        else if (args[1].compareTo("Tramwaj")==0&&ex.compareTo("car")!=0) {
        	Tramwaj tram = new Tramwaj();
        	EdycjaTramwaju edycja = new EdycjaTramwaju(tram);
            if (ex.compareTo("tram")!=0)
            	path+=".tram";
        	edycja.edycja(path);
        }
    }

    public static void deserializacja(String path) throws IOException, ClassNotFoundException {
        File file = new File(path);
        String ex=getFileExtension(file);
        ObjectInputStream input = new ObjectInputStream( new BufferedInputStream( new FileInputStream(path)));
        if(ex.compareTo("car")==0) {
            Samochod car = (Samochod)input.readObject();
            EdycjaSamochodu edycja = new EdycjaSamochodu(car);
            edycja.edycja(path);
        }
        else {
            Tramwaj tram = (Tramwaj)input.readObject();
            EdycjaTramwaju edycja = new EdycjaTramwaju(tram);
            edycja.edycja(path);
        }
        input.close();
    }
}
